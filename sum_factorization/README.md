# CEED Benchmarks
This project demonstrates the implementation and performance comparison of [CEED BK2](https://ceed.exascaleproject.org/bps/) using both **CUDA** and **Kokkos** on single GPU. For algorithm verification and comparison purposes, serial versions of the kernels are also included.

## Features

- CUDA and Kokkos-based GPU implementations
- Serial baseline for verification
- Performance benchmarking

## Software Dependencies

- [Kokkos](https://github.com/kokkos/kokkos) (must be installed with GPU backend enabled)


## Building the Project

After cloning the repository:

```bash
mkdir build && cd build
cmake -DENABLE_TESTS=OFF ..
make -j 
```

## Benchmarks and Input Parameters
### 1. **./benchmark**

This benchmark compares the performance of the sum factorization algorithm implemented in **CUDA** and **Kokkos**.

**Input parameters:**
- **nq0**, **nq1**, **nq2**: Quadrature points in each dimension (element dof per direction + 1)  
- **numThreads**: Number of total threads 
- **threadsPerBlock**: Number of threads per block  
- **nelmt**: Number of elements  
- **ntests**: Number of benchmark repetitions (minimum across all tests, used as a reference for comparison)

### 2. **./block_dimension_benchmark**

This benchmark compares three different CUDA kernels implementing the same sum factorization algorithm:

- **First kernel**: Identical to the original **benchmark** kernel, using a 1D grid and block configuration.
- **Second kernel**: Uses a 3D grid and block layout.
- **Third kernel**: Also employs a 3D grid and block, but with a simplified thread-to-data mapping — each thread processes one data element.

**Input parameters:**
- **nq0**, **nq1**, **nq2**: Quadrature points in each dimension (element dof per direction + 1)  
- **numThreadsX, numThreadsY, numThreadsZ**: Number of total threads in each dimension
- **threadsPerBlockX, threadsPerBlockY, threadsPerBlockZ**: Number of threads per block in each dimension
- **nelmt**: Number of elements  
- **ntests**: Number of benchmark repetitions (minimum across all tests, used as a reference for comparison)

### 3. **./benchmark_output**

This benchmark evaluates all parallel kernels across various polynomial orders, illustrating how the throughput (GDOF/s) of each kernel varies as the number of degrees of freedom (DOF) increases. All benchmark results are saved in the **`<outPath>`** directory. After setting the necessary input parameters in `plot.gp` file, plots can be generated by running:

```bash
cp <CMAKE_SOURCE_DIR>/scripts/plot.gp <outPath>; cd <outPath> 
gnuplot plot.gp
```
**Input parameters:**
- **polyOrderBegin**, **polyOrderEnd**: Polynomial order bounds 
- **dof_ExpBegin**, **dof_ExpEnd**: Range of DOF values as powers of 10 (i.e., DOF = 10^exp)
- **dof_NumSample**: Number of sample between degree of freedom bounds
- **nElmtPerBlock**: Number of thread blocks assigned to each element 
- **ntests**: Number of benchmark repetitions (minimum across all tests, used as a reference for comparison)
- **outPath**: Output path for the results

The following plot illustrates the kokkos kernel results on Nvidia H100 GPU:
![Benchmark Plot](./assets/kokkos.png)

## GPU profiling (CUDA only)
To gain better insight and obtain detailed performance metrics, reports from **Nsight Systems** and **Nsight Compute** can be automatically generated — provided that the appropriate `nsys` and `ncu` environment variables are set. Run the following to generate reports:

```bash
make report
```
The reports will be saved in the **`<build_dir>/reports/`** directory.

To view the results using the Nvidia profiler tools:
```bash
cd build/reports
ncu-ui benchmark_4_4_4_256_16_2000_1.ncu-rep
nsys-ui benchmark_4_4_4_256_16_2000_1.nsys-rep

```